!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit",inactiveButtonClass:"modal__submit_type_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>[...e].some(e=>!e.validity.valid))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(n=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)})})})(n,e)})};function o(e,t,r="Save",n="Saving..."){t?(console.log(`Setting text to ${n}`),e.textContent=n):e.textContent=r}n(e);const a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._handleServerResponse)}createCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._handleServerResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._handleServerResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._handleServerResponse)}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._handleServerResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._handleServerResponse)}handleCardLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._handleServerResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"9174fee8-14cf-423d-8847-48b971305a7a","Content-Type":"application/json"}});a.getAppInfo().then(([e,t])=>{e.forEach(function(e){const t=N(e);U.append(t)}),m.textContent=t.name,_.textContent=t.about,g.src=t.avatar}).catch(console.error);const s=document.querySelector(".profile__edit-btn"),c=document.querySelector("#edit-profile-modal"),i=(c.querySelector("#profile-submit"),c.querySelector(".modal__close-btn")),l=c.querySelector(".modal__form"),d=l.querySelector("#profile-name-input"),u=l.querySelector("#profile-desc-input"),m=document.querySelector(".profile__name"),_=document.querySelector(".profile__description"),h=document.querySelector(".profile__new-post"),f=document.querySelector("#new-post-modal"),v=(f.querySelector("#card-submit"),f.querySelector(".modal__close-btn")),p=f.querySelector(".modal__form"),y=p.querySelector("#card-caption-input"),S=p.querySelector("#card-image-input"),b=document.querySelector(".profile__avatar-btn"),q=document.querySelector("#edit-avatar-modal"),E=q.querySelector(".modal__close-btn"),L=(q.querySelector("#card-submit"),q.querySelector("#profile-avatar-input")),C=q.querySelector(".modal__form"),g=document.querySelector(".profile__avatar"),k=document.querySelector("#card-template").content.querySelector(".card"),U=document.querySelector(".cards__list"),x=document.querySelector("#delete-modal"),$=x.querySelector(".modal__close-btn"),T=x.querySelector("#delete-form");let A,D;const I=document.querySelector(".btn_cancel"),R=document.querySelector("#image-preview-modal"),w=R.querySelector(".modal__image"),P=R.querySelector(".modal__close_type_preview"),B=R.querySelector(".modal__caption");function N(e){let t=k.cloneNode(!0);const r=t.querySelector(".card__title"),n=t.querySelector(".card__image");n.src=e.link,n.alt=e.name,r.textContent=e.name;const o=t.querySelector(".card__heart-btn");return o.addEventListener("click",t=>function(e,t){const r=e.target,n=r.classList.contains("card__heart-btn_active");a.handleCardLike(t._id,n).then(()=>{r.classList.toggle("card__heart-btn_active")}).catch(console.error)}(t,e)),e.isLiked&&o.classList.add("card__heart-btn_active"),t.querySelector(".card__delete-btn").addEventListener("click",()=>function(e,t){A=e,D=t,J(x)}(t,e._id)),n.addEventListener("click",()=>{w.src=e.link,w.alt=e.name,B.textContent=e.name,J(R)}),t}function O(e){"Escape"!==e.key&&"Esc"!==e.key||H(document.querySelector(".modal_is-opened"))}function j(e){e.target.classList.contains("modal_is-opened")&&H(e.target)}function J(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",O),e.addEventListener("click",j)}function H(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",O),e.removeEventListener("click",j)}I.addEventListener("click",function(){o(I,!0,"Cancel","Canceling..."),H(x),setTimeout(()=>{o(I,!1,"Cancel","Canceling...")},300)}),$.addEventListener("click",function(){H(x)}),s.addEventListener("click",function(){var r,n;J(c),d.value=m.textContent,u.value=_.textContent,r=l,n=e,[d,u].forEach(e=>{t(r,e,n)})}),i.addEventListener("click",function(){H(c)}),h.addEventListener("click",function(){J(f)}),v.addEventListener("click",function(){H(f)}),b.addEventListener("click",function(){J(q)}),E.addEventListener("click",function(){H(q)}),C.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;o(t,!0),a.editAvatarInfo(L.value).then(e=>{g.src=e.avatar,H(q),console.log(e.avatar)}).catch(console.error).finally(()=>{setTimeout(()=>{o(t,!1)},300)})}),l.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;o(t,!0),a.editUserInfo({name:d.value,about:u.value}).then(e=>{m.textContent=e.name,_.textContent=e.about,H(c)}).catch(console.error).finally(()=>{setTimeout(()=>{o(t,!1)},300)})}),T.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;o(t,!0,"Delete","Deleting..."),a.deleteCard(D).then(()=>{A.remove(),H(x)}).catch(console.error).finally(()=>{setTimeout(()=>{o(t,!1,"Delete","Deleting...")},300)})}),p.addEventListener("submit",function(t){t.preventDefault();const n={name:y.value,link:S.value},s=t.submitter;o(s,!0),a.createCard(n).then(e=>{const t=N(e);U.prepend(t)}).catch(console.error).finally(()=>{setTimeout(()=>{o(s,!1)},300)}),t.target.reset(),r([y,S],t.submitter,e),H(f)}),P.addEventListener("click",function(){H(R)}),n(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUVuQkUsRUFBWXBCLEVBQUlxQixVQUN0QmhILEVBQWMrRyxHQUFXLEdBQ3pCeEcsRUFDR29CLFdBQVd1RixHQUNYeEYsS0FBTTBELElBQ0wsTUFBTXhELEVBQU9rQixFQUFlc0MsR0FDNUJyQyxFQUFVb0UsUUFBUXZGLEtBRW5CeUIsTUFBTWhELFFBQVFpRCxPQUVkMkQsUUFBUSxLQUNQTixXQUFXLEtBQ1QzRyxFQUFjK0csR0FBVyxJQUN4QixPQUVQcEIsRUFBSUUsT0FBT3VCLFFBQ1gzSSxFQUNFLENBQUN3RixFQUFrQkMsR0FDbkJ5QixFQUFJcUIsVUFDSnZKLEdBRUY4SSxFQUFXekMsRUFDYixHQU1Bb0IsRUFBcUJ2RixpQkFBaUIsUUFBUyxXQUM3QzRHLEVBQVd2QixFQUNiLEdBRUE3RixFQUFpQjFCLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0XCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdF90eXBlX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG4vLyB2YWxpZGF0aW9uIGVycm9yIG1lc3NhZ2VzXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWwsIGlucHV0RWwsIGVycm9yTXNnLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgZXJyb3JNc2dFbC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBbLi4uaW5wdXRMaXN0XS5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuLy8gRGlzYWJsZSBidXR0b24gd2hlbiBpbnZhbGlkXG5leHBvcnQgY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoXHJcbiAgYnRuLFxyXG4gIGlzTG9hZGluZyxcclxuICBkZWZhdWx0VGV4dCA9IFwiU2F2ZVwiLFxyXG4gIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIlxyXG4pIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgU2V0dGluZyB0ZXh0IHRvICR7bG9hZGluZ1RleHR9YCk7XHJcbiAgICBidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICB9IGVsc2Uge1xyXG4gICAgYnRuLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG5pbXBvcnQge1xyXG4gIGVuYWJsZVZhbGlkYXRpb24sXHJcbiAgc2V0dGluZ3MsXHJcbiAgcmVzZXRWYWxpZGF0aW9uLFxyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlLFxyXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcclxuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5cclxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiU3VuZmxvd2VyXCIsXHJcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTQ4MjkxNjE2LWJmY2NjOGRiNzMxZD9xPTgwJnc9NjI3JmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMS4wJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxyXG4vLyAgIH0sXHJcblxyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiUG9sYXJvaWRcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1NzYyNjEyNDA3MjYtYjQ3ODJkZmNkMDJlP3E9ODAmdz03MzUmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4xLjAmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXHJcbi8vICAgfSxcclxuXHJcbi8vICAge1xyXG4vLyAgICAgbmFtZTogXCJTdW5mbG93ZXIgRmllbGRcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1OTkyNzA2MTM1NzAtYTYyMGYyZTU5Zjc1P3E9ODAmdz0xMTcwJmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMS4wJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxyXG4vLyAgIH0sXHJcblxyXG4vLyAgIHtcclxuLy8gICAgIG5hbWU6IFwiVmlraW5nIEJvYXRcIixcclxuLy8gICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE2NjMzMzYwMTQ3NDEtNDFiODRmZWQwNTBmP3E9ODAmdz04ODAmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4xLjAmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXHJcbi8vICAgfSxcclxuXHJcbi8vICAge1xyXG4vLyAgICAgbmFtZTogXCJXaGl0ZSBhbmQgYnJvd24gb3dsIG9uIGEgcGV0YWxlZCBmaWVsZFwiLFxyXG4vLyAgICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTQ2NzgxMTg4NDE5NC1hZTg2OGNkM2YwOTA/cT04MCZ3PTExNzAmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4xLjAmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXHJcbi8vICAgfSxcclxuXHJcbi8vICAge1xyXG4vLyAgICAgbmFtZTogXCJCdWJibGVzXCIsXHJcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNTk0MDM1NTE5OTgxLTYyYzljZWYzM2NhOT9xPTgwJnc9MTE3MSZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjEuMCZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcclxuLy8gICB9LFxyXG5cclxuLy8gICB7XHJcbi8vICAgICBuYW1lOiBcIkdvbGRlbiBHYXRlIEJyaWRnZVwiLFxyXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzctcGhvdG8tYnktZ3JpZmZpbi13b29sZHJpZGdlLWZyb20tcGV4ZWxzLmpwZ1wiLFxyXG4vLyAgIH0sXHJcbi8vIF07XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICAvLyBJbnN0YW50aWF0ZSBhcGlcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCI5MTc0ZmVlOC0xNGNmLTQyM2QtODg0Ny00OGI5NzEzMDVhN2FcIixcclxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gIH0sXHJcbn0pO1xyXG5cclxuYXBpXHJcbiAgLmdldEFwcEluZm8oKVxyXG4gIC50aGVuKChbY2FyZHMsIHVzZXJzXSkgPT4ge1xyXG4gICAgLy8gQ3JlYXRlIG5ldyBjYXJkc1xyXG4gICAgY2FyZHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICBjb25zdCBjYXJkID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XHJcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZCk7XHJcbiAgICB9KTtcclxuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xyXG4gICAgcHJvZmlsZURlc2NFbC50ZXh0Q29udGVudCA9IHVzZXJzLmFib3V0O1xyXG4gICAgYXZhdGFySW1hZ2Uuc3JjID0gdXNlcnMuYXZhdGFyO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG5cclxuLy8gUHJvZmlsZSBzZWxlY3RvcnNcclxuY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBwcm9maWxlRWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0U3VibWl0QnRuID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtc3VibWl0XCIpO1xyXG5jb25zdCBwcm9maWxlRWRpdENsb3NlQnRuID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0Rm9ybUVsID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBwcm9maWxlRWRpdE5hbWVJbnB1dCA9IHByb2ZpbGVFZGl0Rm9ybUVsLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcclxuKTtcclxuY29uc3QgcHJvZmlsZUVkaXREZXNjSW5wdXQgPSBwcm9maWxlRWRpdEZvcm1FbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzYy1pbnB1dFwiXHJcbik7XHJcblxyXG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBwcm9maWxlRGVzY0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuXHJcbi8vIE5ldyBjYXJkIHNlbGVjdG9yc1xyXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uZXctcG9zdFwiKTtcclxuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcclxuY29uc3QgbmV3UG9zdFN1Ym1pdEJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtc3VibWl0XCIpO1xyXG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBuZXdQb3N0Rm9ybUVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XHJcbmNvbnN0IG5ld1Bvc3ROYW1lSW5wdXQgPSBuZXdQb3N0Rm9ybUVsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1jYXB0aW9uLWlucHV0XCIpO1xyXG5jb25zdCBuZXdQb3N0TGlua0lucHV0ID0gbmV3UG9zdEZvcm1FbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XHJcblxyXG4vLyBBdmF0YXIgc2VsZWN0b3JzXHJcbmNvbnN0IGF2YXRhckVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XHJcbmNvbnN0IGF2YXRhckVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XHJcbmNvbnN0IGF2YXRhckVkaXRDbG9zZUJ0biA9IGF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IGF2YXRhckVkaXRTdWJtaXRCdG4gPSBhdmF0YXJFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNjYXJkLXN1Ym1pdFwiKTtcclxuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcclxuY29uc3QgYXZhdGFyRWRpdEZvcm1FbCA9IGF2YXRhckVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5cclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcclxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXHJcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xyXG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xyXG5cclxuLy8gRGVsZXRlIHNlbGVjdG9yc1xyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtZm9ybVwiKTtcclxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XHJcblxyXG5jb25zdCBkZWxldGVDYW5jZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ0bl9jYW5jZWxcIik7XHJcblxyXG4vLyBQcmV2aWV3IG1vZGFsIHNlbGVjdG9yc1xyXG5jb25zdCBpbWFnZVByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtcHJldmlldy1tb2RhbFwiKTtcclxuY29uc3QgaW1hZ2VQcmV2aWV3RWwgPSBpbWFnZVByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuY29uc3QgaW1hZ2VQcmV2aWV3Q2xvc2VCdG4gPSBpbWFnZVByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLm1vZGFsX19jbG9zZV90eXBlX3ByZXZpZXdcIlxyXG4pO1xyXG5jb25zdCBpbWFnZVByZXZpZXdDYXB0aW9uID0gaW1hZ2VQcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcclxuXHJcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcclxuICBsZXQgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcclxuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcblxyXG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XHJcbiAgLy8gY2FyZEltYWdlRWwuaWQgPSBkYXRhLmlkO1xyXG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG5cclxuICAvLyBDYXJkIGxpa2UgYnV0dG9uXHJcbiAgY29uc3QgY2FyZEhlYXJ0SWNvbkVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19oZWFydC1idG5cIik7XHJcbiAgY2FyZEhlYXJ0SWNvbkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PlxyXG4gICAgaGFuZGxlQ2FyZEhlYXJ0SWNvbihldnQsIGRhdGEpXHJcbiAgKTtcclxuXHJcbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xyXG4gICAgY2FyZEhlYXJ0SWNvbkVsLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19oZWFydC1idG5fYWN0aXZlXCIpO1xyXG4gIH1cclxuICAvLyBDYXJkIGRlbGV0ZVxyXG4gIGNvbnN0IGNhcmREZWxldGVCdG5FbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcclxuICBjYXJkRGVsZXRlQnRuRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhLl9pZClcclxuICApO1xyXG5cclxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgaW1hZ2VQcmV2aWV3RWwuc3JjID0gZGF0YS5saW5rO1xyXG4gICAgaW1hZ2VQcmV2aWV3RWwuYWx0ID0gZGF0YS5uYW1lO1xyXG4gICAgaW1hZ2VQcmV2aWV3Q2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgIG9wZW5Nb2RhbChpbWFnZVByZXZpZXdNb2RhbCk7XHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZEhlYXJ0SWNvbihldnQsIGRhdGEpIHtcclxuICBjb25zdCBjYXJkSGVhcnRJY29uID0gZXZ0LnRhcmdldDtcclxuICBjb25zdCBpc0xpa2VkID0gY2FyZEhlYXJ0SWNvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19oZWFydC1idG5fYWN0aXZlXCIpO1xyXG5cclxuICBhcGlcclxuICAgIC5oYW5kbGVDYXJkTGlrZShkYXRhLl9pZCwgaXNMaWtlZClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgY2FyZEhlYXJ0SWNvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9faGVhcnQtYnRuX2FjdGl2ZVwiKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xyXG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xyXG4gIHNlbGVjdGVkQ2FyZElkID0gY2FyZElkO1xyXG4gIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xyXG4gIGFwaVxyXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXHJcbiAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcclxuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcclxuICAgICAgfSwgMzAwKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5kZWxldGVDYW5jZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBzZXRCdXR0b25UZXh0KGRlbGV0ZUNhbmNlbCwgdHJ1ZSwgXCJDYW5jZWxcIiwgXCJDYW5jZWxpbmcuLi5cIik7XHJcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBzZXRCdXR0b25UZXh0KGRlbGV0ZUNhbmNlbCwgZmFsc2UsIFwiQ2FuY2VsXCIsIFwiQ2FuY2VsaW5nLi4uXCIpO1xyXG4gIH0sIDMwMCk7XHJcbn0pO1xyXG5cclxuZGVsZXRlTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUVzY0tleURvd24oZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIgfHwgZXZ0LmtleSA9PT0gXCJFc2NcIikge1xyXG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcclxuICAgIGNsb3NlTW9kYWwobW9kYWwpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlT3V0c2lkZU1vZGFsQ2xpY2soZXZ0KSB7XHJcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfaXMtb3BlbmVkXCIpKSB7XHJcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gT3BlbiBhbmQgY2xvc2UgbW9kYWxzXHJcbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9pcy1vcGVuZWRcIik7XHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjS2V5RG93bik7XHJcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU91dHNpZGVNb2RhbENsaWNrKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xyXG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjS2V5RG93bik7XHJcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU91dHNpZGVNb2RhbENsaWNrKTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XHJcbiAgcHJvZmlsZUVkaXROYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xyXG4gIHByb2ZpbGVFZGl0RGVzY0lucHV0LnZhbHVlID0gcHJvZmlsZURlc2NFbC50ZXh0Q29udGVudDtcclxuICByZXNldFZhbGlkYXRpb24oXHJcbiAgICBwcm9maWxlRWRpdEZvcm1FbCxcclxuICAgIFtwcm9maWxlRWRpdE5hbWVJbnB1dCwgcHJvZmlsZUVkaXREZXNjSW5wdXRdLFxyXG4gICAgc2V0dGluZ3NcclxuICApO1xyXG59KTtcclxuXHJcbnByb2ZpbGVFZGl0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBjbG9zZU1vZGFsKHByb2ZpbGVFZGl0TW9kYWwpO1xyXG59KTtcclxuXHJcbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufSk7XHJcblxyXG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XHJcbn0pO1xyXG5cclxuYXZhdGFyRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIG9wZW5Nb2RhbChhdmF0YXJFZGl0TW9kYWwpO1xyXG59KTtcclxuXHJcbmF2YXRhckVkaXRDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGNsb3NlTW9kYWwoYXZhdGFyRWRpdE1vZGFsKTtcclxufSk7XHJcblxyXG5hdmF0YXJFZGl0Rm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyRWRpdFN1Ym1pdCk7XHJcblxyXG4vLyBTZW5kIGF2YXRhciBpbmZvXHJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckVkaXRTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XHJcbiAgYXBpXHJcbiAgICAuZWRpdEF2YXRhckluZm8oYXZhdGFySW5wdXQudmFsdWUpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBhdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgY2xvc2VNb2RhbChhdmF0YXJFZGl0TW9kYWwpO1xyXG4gICAgICBjb25zb2xlLmxvZyhkYXRhLmF2YXRhcik7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XHJcbiAgICAgIH0sIDMwMCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gRWRpdCBwcm9maWxlIGluZm9ybWF0aW9uXHJcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmVkaXRVc2VySW5mbyh7XHJcbiAgICAgIG5hbWU6IHByb2ZpbGVFZGl0TmFtZUlucHV0LnZhbHVlLFxyXG4gICAgICBhYm91dDogcHJvZmlsZUVkaXREZXNjSW5wdXQudmFsdWUsXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgICAgcHJvZmlsZURlc2NFbC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XHJcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XHJcbiAgICAgIH0sIDMwMCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxucHJvZmlsZUVkaXRGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XHJcblxyXG4vLyBDcmVhdGUgbmV3IGNhcmRzXHJcbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGNvbnN0IGlucHV0VmFsdWVzID0ge1xyXG4gICAgbmFtZTogbmV3UG9zdE5hbWVJbnB1dC52YWx1ZSxcclxuICAgIGxpbms6IG5ld1Bvc3RMaW5rSW5wdXQudmFsdWUsXHJcbiAgfTtcclxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xyXG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcclxuICBhcGlcclxuICAgIC5jcmVhdGVDYXJkKGlucHV0VmFsdWVzKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgY29uc3QgY2FyZCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xyXG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcclxuXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XHJcbiAgICAgIH0sIDMwMCk7XHJcbiAgICB9KTtcclxuICBldnQudGFyZ2V0LnJlc2V0KCk7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoXHJcbiAgICBbbmV3UG9zdE5hbWVJbnB1dCwgbmV3UG9zdExpbmtJbnB1dF0sXHJcbiAgICBldnQuc3VibWl0dGVyLFxyXG4gICAgc2V0dGluZ3NcclxuICApO1xyXG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcclxufVxyXG5cclxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XHJcblxyXG5uZXdQb3N0Rm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XHJcblxyXG5pbWFnZVByZXZpZXdDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIGNsb3NlTW9kYWwoaW1hZ2VQcmV2aWV3TW9kYWwpO1xyXG59KTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG4iLCJjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcblxyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVDYXJkKGNhcmQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWU6IGNhcmQubmFtZSxcclxuICAgICAgICBsaW5rOiBjYXJkLmxpbmssXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgYWJvdXQsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XHJcbiAgfVxyXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhdmF0YXIsXHJcbiAgICAgIH0pLFxyXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlQ2FyZExpa2UoaWQsIGlzTGlrZWQpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEFwaTtcclxuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJjb25maWciLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJhZGQiLCJlbmFibGVWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNldEV2ZW50TGlzdGVuZXJzIiwiYnV0dG9uRWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTXNnIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJzZXRCdXR0b25UZXh0IiwiYnRuIiwiaXNMb2FkaW5nIiwiZGVmYXVsdFRleHQiLCJsb2FkaW5nVGV4dCIsImNvbnNvbGUiLCJsb2ciLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfaGFuZGxlU2VydmVyUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiY3JlYXRlQ2FyZCIsImNhcmQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIm5hbWUiLCJsaW5rIiwiZWRpdFVzZXJJbmZvIiwiYWJvdXQiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImRlbGV0ZUNhcmQiLCJoYW5kbGVDYXJkTGlrZSIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJ1c2VycyIsIml0ZW0iLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsImFwcGVuZCIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY0VsIiwiYXZhdGFySW1hZ2UiLCJzcmMiLCJjYXRjaCIsImVycm9yIiwicHJvZmlsZUVkaXRCdG4iLCJwcm9maWxlRWRpdE1vZGFsIiwicHJvZmlsZUVkaXRDbG9zZUJ0biIsInByb2ZpbGVFZGl0Rm9ybUVsIiwicHJvZmlsZUVkaXROYW1lSW5wdXQiLCJwcm9maWxlRWRpdERlc2NJbnB1dCIsIm5ld1Bvc3RCdG4iLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0Q2xvc2VCdG4iLCJuZXdQb3N0Rm9ybUVsIiwibmV3UG9zdE5hbWVJbnB1dCIsIm5ld1Bvc3RMaW5rSW5wdXQiLCJhdmF0YXJFZGl0QnRuIiwiYXZhdGFyRWRpdE1vZGFsIiwiYXZhdGFyRWRpdENsb3NlQnRuIiwiYXZhdGFySW5wdXQiLCJhdmF0YXJFZGl0Rm9ybUVsIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlTW9kYWxDbG9zZUJ0biIsImRlbGV0ZUZvcm0iLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImRlbGV0ZUNhbmNlbCIsImltYWdlUHJldmlld01vZGFsIiwiaW1hZ2VQcmV2aWV3RWwiLCJpbWFnZVByZXZpZXdDbG9zZUJ0biIsImltYWdlUHJldmlld0NhcHRpb24iLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwiYWx0IiwiY2FyZEhlYXJ0SWNvbkVsIiwiZXZ0IiwiY2FyZEhlYXJ0SWNvbiIsInRhcmdldCIsImNvbnRhaW5zIiwiX2lkIiwidG9nZ2xlIiwiaGFuZGxlQ2FyZEhlYXJ0SWNvbiIsImNhcmRJZCIsIm9wZW5Nb2RhbCIsImhhbmRsZURlbGV0ZUNhcmQiLCJoYW5kbGVFc2NLZXlEb3duIiwia2V5IiwiY2xvc2VNb2RhbCIsImhhbmRsZU91dHNpZGVNb2RhbENsaWNrIiwibW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0VGltZW91dCIsInJlc2V0VmFsaWRhdGlvbiIsInZhbHVlIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXRCdG4iLCJzdWJtaXR0ZXIiLCJmaW5hbGx5IiwiaW5wdXRWYWx1ZXMiLCJwcmVwZW5kIiwicmVzZXQiXSwic291cmNlUm9vdCI6IiJ9